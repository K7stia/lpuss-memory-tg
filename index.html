<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Silkscreen:wght@700&display=swap" rel="stylesheet">
    <title>Memory Card Game</title>
    <style>
        /* Ваші CSS стилі */
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }

        h1 {
            font-family: 'Silkscreen', cursive;
            font-size: 2em;
        }

        #menu, #game-container, #name-modal, #leaderboard-container {
            display: none;
        }

        .active {
            display: block;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .card {
            width: 100px;
            height: 100px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 2em;
            color: transparent;
        }

        .card.matched {
            background-color: #4CAF50;
            color: #fff;
        }

        .card.flipped {
            background-color: #f0f0f0;
            color: #000;
        }

        #name-modal input {
            padding: 8px;
            width: 80%;
            margin: 10px 0;
        }

        #leaderboard-list {
            list-style-type: none;
            padding: 0;
        }

        #leaderboard-list li {
            padding: 5px 0;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>

    <div id="menu" class="active">
        <h1>Memory Card Game</h1>
        <button onclick="startGameFromMenu()">Start</button>
        <button onclick="showLeaderboard()">Leaderboard</button>
    </div>

    <div id="game-container">
        <h1>Memory Card Game</h1>
        <p>Time Left: <span id="timer">60</span> seconds</p>
        <div class="stats">
            <p>Round: <span id="round">1</span></p>
            <p>Score: <span id="score">0</span></p>
        </div>
        <div id="game-board"></div>
    </div>

    <div id="name-modal">
        <h2>Game Over</h2>
        <p>Your Score: <span id="final-score">0</span></p>
        <input type="text" id="player-name" placeholder="Enter your name" maxlength="15">
        <button onclick="submitScore()">Submit Score</button>
        <button onclick="restartGame()">Restart Game</button>
    </div>

    <div id="leaderboard-container">
        <h1>Leaderboard</h1>
        <ul id="leaderboard-list"></ul>
        <button onclick="backToMenu()">Back to Menu</button>
    </div>

    <audio id="returnSound" src="audio/return.wav" preload="auto"></audio>
    <audio id="doneSound" src="audio/done.wav" preload="auto"></audio>
    <audio id="nextSound" src="audio/next.wav" preload="auto"></audio>
    <audio id="overSound" src="audio/over.wav" preload="auto"></audio>

    <script>
        // Ініціалізація Telegram Web App API
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Підключення до Telegram API
        tg.onEvent('mainButtonClicked', () => {
            startGameFromMenu();
        });

        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let score = 0;
        let round = 0;
        let timeLeft = 60;
        let timer;

        const scoreDisplay = document.getElementById("score");
        const roundDisplay = document.getElementById("round");
        const timerDisplay = document.getElementById("timer");
        const gameBoard = document.getElementById("game-board");
        const finalScoreDisplay = document.getElementById("final-score");

        // Запуск гри
        function startGameFromMenu() {
            document.getElementById("menu").classList.remove("active");
            document.getElementById("game-container").classList.add("active");
            clearInterval(timer);
            resetGame();
            startGame();
        }

        function startGame() {
            round++;
            matchedPairs = 0;
            score = 0;
            timeLeft = 60;
            scoreDisplay.textContent = score;
            timerDisplay.textContent = timeLeft;
            roundDisplay.textContent = round;

            generateCards();
            timer = setInterval(updateTimer, 1000);
        }

        function generateCards() {
            cards = [];
            const cardValues = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
            const shuffledCards = [...cardValues, ...cardValues].sort(() => Math.random() - 0.5);

            shuffledCards.forEach(value => {
                const cardElement = document.createElement("div");
                cardElement.classList.add("card");
                cardElement.dataset.value = value;
                cardElement.onclick = flipCard;
                cards.push(cardElement);
            });

            gameBoard.innerHTML = '';
            cards.forEach(card => {
                gameBoard.appendChild(card);
            });
        }

        function flipCard(event) {
            const clickedCard = event.target;
            if (flippedCards.length === 2 || clickedCard.classList.contains("flipped")) return;
            clickedCard.classList.add("flipped");
            clickedCard.textContent = clickedCard.dataset.value;
            flippedCards.push(clickedCard);

            if (flippedCards.length === 2) {
                checkMatch();
            }
        }

        function checkMatch() {
            const [firstCard, secondCard] = flippedCards;

            if (firstCard.dataset.value === secondCard.dataset.value) {
                firstCard.classList.add("matched");
                secondCard.classList.add("matched");
                matchedPairs++;
                score += 10;
                scoreDisplay.textContent = score;
                playSound("nextSound");
                if (matchedPairs === cards.length / 2) {
                    clearInterval(timer);
                    showGameOver();
                }
            } else {
                setTimeout(() => {
                    firstCard.classList.remove("flipped");
                    secondCard.classList.remove("flipped");
                    firstCard.textContent = '';
                    secondCard.textContent = '';
                }, 1000);
            }
            flippedCards = [];
        }

        function updateTimer() {
            timeLeft--;
            timerDisplay.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(timer);
                showGameOver();
            }
        }

        function showGameOver() {
            document.getElementById("game-container").classList.remove("active");
            document.getElementById("name-modal").classList.add("active");
            finalScoreDisplay.textContent = score;
        }

        function submitScore() {
            const playerNameInput = document.getElementById("player-name");
            const playerName = playerNameInput.value.trim();
            if (!playerName) {
                playerNameInput.classList.add("error");
                return;
            }
            playerNameInput.classList.remove("error");

            // Збереження результату на сервері або в локальному сховищі
            console.log(`Submitted: ${playerName} with score: ${score}`);

            // Переходь назад до меню
            document.getElementById("name-modal").classList.remove("active");
            document.getElementById("menu").classList.add("active");

            loadLeaderboard();
        }

        function loadLeaderboard() {
            // Завантаження таблиці лідерів (можна використати Firebase або інший бекенд)
            document.getElementById("leaderboard-container").classList.add("active");
            const leaderboard = [
                { name: "Alice", score: 100 },
                { name: "Bob", score: 80 },
                { name: "Charlie", score: 60 },
            ];

            const leaderboardList = document.getElementById("leaderboard-list");
            leaderboardList.innerHTML = '';
            leaderboard.forEach(entry => {
                const li = document.createElement("li");
                li.textContent = `${entry.name}: ${entry.score}`;
                leaderboardList.appendChild(li);
            });
        }

        function backToMenu() {
            document.getElementById("leaderboard-container").classList.remove("active");
            document.getElementById("menu").classList.add("active");
        }

        function restartGame() {
            document.getElementById("name-modal").classList.remove("active");
            startGameFromMenu();
        }

        function playSound(id) {
            document.getElementById(id).play();
        }
    </script>

</body>

</html>
